<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="fonts/icomoon/style.css" />

    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="icon" type="image/png" href="/images/logo.png" />

    <!-- Style -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/attendance.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@600&family=Poppins:wght@300&display=swap"
      rel="stylesheet"
    />
    <title> Employee Details </title>
  </head>

  <body>
    <header style="display: flex; margin-top: 20px">
      <a href="admin.html"><img src="images/FBEYE.png" class="logo-img" /></a>

      <input type="checkbox" id="nav_check" hidden />
      <nav>
        <ul>
          <li>
            <a href="admin.html">Home</a>
          </li>
          <li>
            <a href="leaveRequest.html">Leave Request</a>
          </li>
          <li>
            <a href="index.html">Logout</a>
          </li>
        </ul>
      </nav>
      <label for="nav_check" class="hamburger">
        <div></div>
        <div></div>
        <div></div>
      </label>
    </header>

    <body>

  <div class="col">
<div class="row">
<div class="col mb-3">
<div class="card" style="margin-top: 30px; margin-left: 30px; margin-right: 30px;">
<div class="card-body">
<div class="e-profile">
<div class="row">
<div class="col-12 col-sm-auto mb-3">
<div class="mx-auto" style="width: 140px;">
<div class="d-flex justify-content-center align-items-center rounded" style="height: 140px; background-color: rgb(233, 236, 239);">
  <span style="color: rgb(166, 168, 170); font: bold 8pt Arial;">140x140</span>
  <div class="d-flex justify-content-center align-items-center rounded" style="height: 140px; background-color: rgb(233, 236, 239);">
    <img id="selectedProfilePicture" style="max-width: 100%; max-height: 100%; display: none;">
  </div>
</div>
</div>
</div>
<div class="col d-flex flex-column flex-sm-row justify-content-between mb-3">
<div class="text-center text-sm-left mb-2 mb-sm-0" style="margin-top: auto;">

<div class="mt-2">
<button class="btn btn-primary" type="button" onclick="document.getElementById('profilePicture').click();">
    <i class="fa fa-fw fa-camera"></i>
    <span>Update Profile Picture</span>
</button>
<input type="file" accept="image/*" id="profilePicture" class="form-control" style="display: none;">

</div>
</div>


<div class="text-center text-sm-right">
<span class="badge badge-secondary">administrator</span>
<div class="text-muted"><small id="joinDate">Joined 09 Dec 2017</small></div>
</div>
</div>
</div>
<ul class="nav nav-tabs">
<li class="nav-item"><a href class="active nav-link">Employee Information</a></li>
</ul>
<div class="tab-content pt-3">
<div class="tab-pane active">
<form class="form" novalidate>
<div class="row">
<div class="col">
<div class="row">
<div class="col">
<div class="form-group">
<label>Full Name</label>
<input class="form-control" type="text" name="Name" id="name" required>
</div>
</div>
<div class="col">
<div class="form-group">
<label>Phone Number</label>
<input class="form-control" type="text" name="PhoneNumber" id="phoneNo" required>
</div>
</div>
</div>

<div class="row">
<div class="col">
<div class="row">
<div class="col">
<div class="form-group">
<label>Email</label>
<input class="form-control" type="text" name="Email" id="email" required>
</div>
</div>
<div class="col">
<div class="form-group">
<label>Gender</label>
 <input class="form-control" type="text" name="Gender" id="gender" required>

</div>
</div>
</div>

<div class="row">
<div class="col">
<div class="row">
<div class="col">
<div class="form-group">
<label>Department</label>
<input class="form-control" type="text" name="Department" id="department" required>
</div>
</div>
<div class="col">
<div class="form-group">
<label>Role</label>
<input class="form-control" type="text" name="Role" id="role" required>
</div>
</div>
</div>

<div class="d-flex justify-content-end" style="margin-top: 20px;">
  <button class="btn" type="submit" id="deleteRecord" style="margin-right: 20px;background-color: red;color: white;">Delete Record</button>
  <button class="btn btn-primary" type="submit" id="updateRecord">Update Record</button>

</div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>

    </body>
    
       
 
  <script type="module">


    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, update, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, deleteUser} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import {getStorage, ref as storageRef, uploadBytes, deleteObject} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAQDU7-hbWtI3sa3s3woi4YfUJtiVRYhGg",
        authDomain: "fbeye-bf2f1.firebaseapp.com",
        databaseURL: "https://fbeye-bf2f1-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "fbeye-bf2f1",
        storageBucket: "fbeye-bf2f1.appspot.com",
        messagingSenderId: "462631567055",
        appId: "1:462631567055:web:bc8ee774e09e56e8fcc1ba",
        measurementId: "G-83NWPL2V92"
      };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();
    const storage = getStorage(app);
    const urlParams = new URLSearchParams(window.location.search);
    const userID = urlParams.get('userID');
    const deleteBtn = document.getElementById("deleteRecord");
    const updateBtn = document.getElementById("updateRecord");
 
    const employeeRef = ref(database, `Employees/${userID}`);
    get(employeeRef).then((snapshot) => {
      const employeeData = snapshot.val();
      document.getElementById("name").value = employeeData.Name;
      document.getElementById("phoneNo").value = employeeData.PhoneNumber;
      document.getElementById("email").value = employeeData.Email;
      document.getElementById("department").value= employeeData.Department;
      document.getElementById("role").value = employeeData.Role;
      document.getElementById("joinDate").innerHTML = `Joined ${employeeData.JoinDate}`;
      document.getElementById("gender").value = employeeData.Gender;
    }).catch((error) => {
      alert("error: ", error);
      window.location.href = "admin.html";

    });
  


     updateBtn.addEventListener("click", function (e) {
          event.preventDefault();
          const updatedName = document.getElementById("name").value;
          const updatedPhoneNo = document.getElementById("phoneNo").value;
          const updatedEmail = document.getElementById("email").value;
          const updatedDepartment = document.getElementById("department").value;
          const updatedRole = document.getElementById("role").value;
          const updatedGender = document.getElementById("gender").value;

          // Update the record in Firebase Realtime Database
          update(ref(database, `Employees/${userID}`), {
            Name: updatedName,
            PhoneNumber: updatedPhoneNo,
            Email: updatedEmail,
            Department: updatedDepartment,
            Role: updatedRole,
            Gender: updatedGender
          }).then(() => {
            alert("Record updated successfully!");
            window.location.href = "admin.html";
          });
        });


        deleteBtn.addEventListener("click", function(e) {
        event.preventDefault();

        if (confirm("Are you sure you want to delete this record?")) {
          const employeeRef = ref(database, `Employees/${userID}`);
          const storagePath = `${userID}.png`; 
          const imageRef = storageRef(storage, storagePath); 
          const user = getAuth().currentUser;
              
          if (!user) {
          alert("User not authenticated!");
          return;
          }

          
          Promise.all([
            deleteUser(user), // delete user in firebase authentication
            deleteObject(imageRef), // delete image in firebase storage
            remove(employeeRef) // delete employee personal details in firebase realtime
          ]).then(() => {
            alert("Record deleted successfully!");
            window.location.href = "admin.html";
          }).catch((error) => {
            alert("Error deleting record: " + error.message);
          });
        
        }
      });

     

    


  </script>
</body>
</html>
